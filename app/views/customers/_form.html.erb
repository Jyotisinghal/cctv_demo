
<script>
  
  var cctvs = <%= Cctv.all.group_by{|x| [x.product.name, x.product_id].join(":") }.to_json.html_safe %>;
  var cctvsPrice = <%= Cctv.all.group_by{|x| [x.product.name, x.id].join(":") }.to_json.html_safe %>;

$(document).ready(function(){

  //for Dome camera
  selectedCategory = $('.dome-camera-dropdown').text();  
 
  selectedBrand = 1;
  selectProducts = cctvs[selectedCategory + ":" + selectedBrand];

  productDropdown = $('.dome-camera-category');
  productDropdown.empty();

  productDropdown.append($("<option></option>")
    .attr("value","")
    .text("Select category")); 

  $.each(selectProducts, function(key, cctv) {  
      productDropdown.append($("<option></option>")
        .attr("value",cctv.id)
        .text(cctv.category)); 
  });


    //for Bullet camera
    selectedCategory = $('.bullet-camera-dropdown').text();  
   
    selectedBrand = 2;
    selectProducts = cctvs[selectedCategory + ":" + selectedBrand];

    productDropdown = $('.bullet-camera-category');
    productDropdown.empty();

    productDropdown.append($("<option></option>")
      .attr("value","")
      .text("Select category")); 

    $.each(selectProducts, function(key, cctv) {  
        productDropdown.append($("<option></option>")
          .attr("value",cctv.id)
          .text(cctv.category)); 
    });


    //for dvr
    selectedCategory = $('.dvr-dropdown').text();
  
    selectedBrand = 3;
    selectProducts = cctvs[selectedCategory + ":" + selectedBrand];
    
    productDropdown = $('.dvr-category');
    productDropdown.empty();

    productDropdown.append($("<option></option>")
        .attr("value","")
        .text("Select category")); 

    $.each(selectProducts, function(key, cctv) { 
       // alert('hii');  
        productDropdown.append($("<option></option>")
          .attr("value",cctv.id)
          .text(cctv.category)); 
    });

    //for smps
    selectedCategory = $('.smps-dropdown').text();
    
    selectedBrand = 4;
    selectProducts = cctvs[selectedCategory + ":" + selectedBrand];

    productDropdown = $('.smps-category');
    productDropdown.empty();

    productDropdown.append($("<option></option>")
       .attr("value","")
       .text("Select category")); 

    $.each(selectProducts, function(key, cctv) {  
        productDropdown.append($("<option></option>")
          .attr("value",cctv.id)
          .text(cctv.category)); 
    });

    //for connector
    selectedCategory = $('.connector-dropdown').text();
    
    selectedBrand = 5;
    selectProducts = cctvs[selectedCategory + ":" + selectedBrand];
     
    productDropdown = $('.connector-category');
    productDropdown.empty();

    productDropdown.append($("<option></option>")
        .attr("value","")
        .text("Select category")); 

    $.each(selectProducts, function(key, cctv) { 
    productDropdown.append($("<option></option>")
        .attr("value",cctv.id)
        .text(cctv.category)); 
    });
    
    //FOR HDD
    selectedCategory = $('.hdd-dropdown').text();

    selectedBrand = 6;
    selectProducts = cctvs[selectedCategory + ":" + selectedBrand];
 
    productDropdown = $('.hdd-category');
    productDropdown.empty();

    productDropdown.append($("<option></option>")
       .attr("value","")
       .text("Select category")); 

    $.each(selectProducts, function(key, cctv) { 
        
    productDropdown.append($("<option></option>")
          .attr("value",cctv.id)
          .text(cctv.category)); 
    });

    // for wire
    selectedCategory = $('.wire-dropdown').text();
    selectedBrand = 7;
    selectProducts = cctvs[selectedCategory + ":" + selectedBrand];

    productDropdown = $('.wire-category');
    productDropdown.empty();

    productDropdown.append($("<option></option>")
        .attr("value","")
        .text("Select category")); 

    $.each(selectProducts, function(key, cctv) { 
       // alert('hii');  
        productDropdown.append($("<option></option>")
          .attr("value",cctv.id)
          .text(cctv.category)); 
    });

    //for installation
    selectedCategory = $('.installation-dropdown').text();

    selectedBrand = 8;
    selectProducts = cctvs[selectedCategory + ":" + selectedBrand];
    
  productDropdown = $('.installation-category');
    productDropdown.empty();

    productDropdown.append($("<option></option>")
        .attr("value","")
        .text("Select category")); 

    $.each(selectProducts, function(key, cctv) { 
       
        productDropdown.append($("<option></option>")
          .attr("value",cctv.id)
          .text(cctv.category)); 
    });
});


 jQuery(function() {
  var grandTotal = 0;
    return $(document).on("change",".cctv",function(){
      selectedBrand = $(this).parent('td').prev('td').text();
      // alert(selectedBrand);
      selectedCategory = $(this).val();
      // alert(selectedCategory);
      selectProducts = cctvsPrice[selectedBrand + ":" + selectedCategory];
      productPrice = $(this).parent('td').next('td').children('.price');
      productPrice.empty();

      var price = selectProducts[0].price;
      $(this).parent('td').next('td').children('.price').val(price);
      var qty = $(this).parent('td').next('td').next('td').children('.qty').val();

      var place_total = $(this).parent('td').next('td').next('td').next('td').children('.total')
      
      if (qty == undefined) {
        var total = price;
        place_total.html(total);
        grandTotal += total;
      }
      else{ 
        var qty = $(this).parent('td').next('td').next('td').children('.qty').val();
        var total = price * qty;
        place_total.html(total);
        grandTotal += total;
      }
      $('.grandTotal').html(grandTotal);
    });
    
  });


function addition(){
    var dome = Number(document.getElementById("dome").value);
    $('.domeQty').val(dome);

    var bullet = Number(document.getElementById("bullet").value);
    $('.bulletQty').val(bullet);
    var add = (dome + bullet);
    document.getElementById('demo').innerHTML = add;
}

</script>

  <%= simple_form_for(@customer) do |f| %>
  <%= f.error_notification %>
  <%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>

  <div class="breadcrumb" style="background-color: #000000;">
    <div class="card-header">
      <h2 style="color: white;">CAMERA</h2>
    </div>
    <table class="breadcrumb-item table">
      <tbody>
        <tr>
          <td><strong>DOME CAMERA:</strong><input type="number_field" name="" class="form-control" placeholder="  QUANTITY..." id="dome" onkeyup="addition()"></td>
          <td><strong>BULLET CAMERA:</strong><input type="number_field" name="" class="form-control" placeholder="  QUANTITY..." id="bullet" onkeyup="addition()"></td>
          <td><strong>TOTAL CAMERA:  </strong><br><span id="demo" style="font-size: 24px;"></span></td>
        </tr>
      </tbody>
    </table>
  </div> 
  
  <%= render 'item', f: f %> 
  <%= render 'customer', f: f %> 

<% end %>


